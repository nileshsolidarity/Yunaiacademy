[build]
builder = "nixpacks"
buildCommand = "corepack enable && corepack prepare pnpm@10.30.0 --activate && cd /app && pnpm install --frozen-lockfile && pnpm --filter @yunai/api build"

[build.nixpacks]
installCommand = "corepack enable && corepack prepare pnpm@10.30.0 --activate && cd /app && pnpm install --frozen-lockfile"

[deploy]
startCommand = "corepack enable && cd /app/apps/api && npx prisma db push --skip-generate && pnpm start"
healthcheckPath = "/api/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3
